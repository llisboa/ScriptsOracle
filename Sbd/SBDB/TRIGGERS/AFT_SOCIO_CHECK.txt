create or replace TRIGGER SBDB.AFT_SOCIO_CHECK
AFTER INSERT OR UPDATE ON SBDB.SÓCIO
DECLARE
  QTD INTEGER;
BEGIN
  FOR CUR IN (SELECT * FROM (SELECT EMAIL, COUNT(MAT) QTD FROM SBDB.VW_LOGIN_EMAIL GROUP BY EMAIL) WHERE QTD>1) LOOP
    RAISE_APPLICATION_ERROR(-20000, 'Um dos emails informados encontra-se vinculado à outra matrícula.');
  END LOOP;
END;
