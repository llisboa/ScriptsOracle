[001]
net use \\201.49.216.134\C$ "XXXXXXXXXXX" /USER:ADMINISTRADOR
SYNCDOS -DIR C:\oracle\product\11.2.0\flash_recovery_area\SBDB -REPL \\201.49.216.134\C$\oracle\product\11.2.0\flash_recovery_area\SBDB -SEMCONFIRM > C:\COPIA_BASE_133_PARA_134_SYNC.LOG

[002]
ECHO SHUTDOWN ABORT | SQLPLUS SYS/XXXX@SBDB_134 AS SYSDBA 
DEL \\201.49.216.134\c$\oracle\product\11.2.0\oradata\SBDB /Q
ECHO STARTUP NOMOUNT | SQLPLUS SYS/XXXX@SBDB_134 AS SYSDBA
RMAN.EXE TARGET 'SYS/XXXX@SBDB_134 AS SYSDBA' @==[RMAN_SCRIPT]
SQLPLUS SYS/XXXX@SBDB_134 AS SYSDBA @==[SQL_SCRIPT]

[RMAN_SCRIPT]
RESTORE CONTROLFILE FROM 'C:\oracle\product\11.2.0\flash_recovery_area\SBDB\AUTOBACKUP\==ultimodirn\==ultimoarqc';
ALTER DATABASE MOUNT;
run {
CONFIGURE CONTROLFILE AUTOBACKUP OFF;
configure device type disk parallelism 1;
configure default device type to disk;
configure channel 1 device type disk format 'C:\oracle\flash_recovery_area\SBDB\BACKUP_ORACLE\RMAN_DISK\1\%d_%T_%s_%t_F.BKP';
crosscheck archivelog all;
crosscheck backupset;
RESTORE DATABASE;
RECOVER DATABASE;
}
EXIT;

[SQL_SCRIPT]
SHUTDOWN NORMAL; 
STARTUP MOUNT;
alter system set db_recovery_file_dest_size=20G scope=both;
ALTER DATABASE OPEN RESETLOGS; 
SHUTDOWN ABORT; 
STARTUP RESTRICT;
SET SERVEROUTPUT ON SIZE 40000
SET HEADING OFF;
SET ECHO OFF;
BEGIN
	FOR JOB IN (SELECT JOB,WHAT FROM DBA_JOBS) LOOP
		BEGIN
		DBMS_OUTPUT.PUT_LINE('BROKEN EM JOB ' || JOB.JOB || ' - ' || JOB.WHAT);
	 	SYS.dbms_ijob.BROKEN(JOB.JOB,TRUE);
		EXCEPTION
		WHEN OTHERS THEN
			DBMS_OUTPUT.PUT_LINE('==> ERRO:' || SQLERRM);
		END;
	END LOOP;
END;
/
COMMIT;
/* DECLARE
  COMA VARCHAR2(4000);
 BEGIN
   FOR CUR IN
  (SELECT OWNER, TABLE_NAME FROM ALL_TABLES WHERE OWNER IN (SELECT USERNAME FROM ALL_USERS WHERE CREATED >= (SELECT CREATED FROM ALL_USERS WHERE USERNAME='SBDB'))
  )
  LOOP
    IF INSTR(';SYS_CONFIG_USUARIO;', ';' || CUR.TABLE_NAME || ';')=0 THEN
      COMA                                                       := 'ALTER TABLE ' || CUR.OWNER || '.' || CUR.TABLE_NAME || ' READ ONLY';
      DBMS_OUTPUT.PUT_LINE(COMA);
      BEGIN
        EXECUTE IMMEDIATE COMA;
      EXCEPTION
      WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('==> ERRO:' || SQLERRM);
      END;
    END IF;
  END LOOP;
 END; */
/
SELECT 'SERVIDOR: ' || MACHINE FROM V$SESSION WHERE PROGRAM = 'ORACLE.EXE (MMAN)';
SELECT 'ULT MOMENTO: ' || TO_CHAR(SBDB.DBMS_ICRAFT.MANUT_ULTIMO_MOMENTO('SBDB'),'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
SELECT 'ID DA BASE: ' || DBID FROM V$DATABASE; 
SELECT 'SCN MAIS RECENTE: ' || TO_CHAR(SCN_TO_TIMESTAMP(CURRENT_SCN),'YYYY-MM-DD HH24:MI:SS') FROM V$DATABASE;
ALTER SYSTEM DISABLE RESTRICTED SESSION;
EXIT;
