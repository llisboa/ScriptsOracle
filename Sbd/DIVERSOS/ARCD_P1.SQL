/* **********************************************************************************
   INTERCRAFT SOLUTIONS INFORMÁTICA LTDA - 2008
   SCRIPT CRIADO EM 22/09/2011 02:42

   IMPORTANTE!!!
   * O SISTEMA LOGARÁ SYSTEM PARA INICIAR A EXECUÇÃO, LOGO, MUITO CUIDADO!
   * CASO O USUÁRIO DO ESQUEMA JÁ EXISTA, ESTE SERÁ ELIMINADO, PORTANTO, TENHA A CERTEZA DAQUILO QUE ESTÁ FAZENDO.
   * ARQUIVO C:\ARCD.LOG REGISTRARÁ O LOG DE EXECUÇÃO, QUE DEVE SER VERIFICADO.
   * CASO BANCO POSSUA ACENTOS, PRECISARÁ GARANTIR FORMATO ANSI ANTES DA EXECUÇÃO. PARA ISSO, EDITE O CONTEÚDO NO NOTEPAD E SALVE FAZENDO OPÇÃO POR ESTE FORMATO.
*/

SET ECHO ON
SET HEADING OFF
SET PAGESIZE 0
SET LINES 10000
SET LINESIZE 10000
SET SERVEROUTPUT ON SIZE 40000
SPOOL C:\ARCD_PARTE1.LOG

-- GARANTINDO QUE TODOS TENHA ACESSO AOS RECURSOS DE PACOTE
CONNECT SYS/XXXX@SBDB AS SYSDBA
GRANT EXECUTE ON SYS.UTL_FILE TO PUBLIC;
GRANT EXECUTE ON SYS.UTL_SMTP TO PUBLIC;
GRANT EXECUTE ON SYS.UTL_TCP TO PUBLIC;
GRANT SELECT ON SYS.V_$SESSION TO PUBLIC;
GRANT QUERY REWRITE TO PUBLIC;
GRANT CREATE MATERIALIZED VIEW TO PUBLIC;
ALTER SESSION SET QUERY_REWRITE_ENABLED = TRUE;

-- ELIMINA OS JOBS
begin
for cur in (select job from user_jobs where schema_user='ARCD') loop
dbms_job.remove(cur.job);
end loop;
end;
/

-- INICIALIZANDO TABLESPACE
ALTER TABLESPACE T_ARCD_DAT OFFLINE;
DROP TABLESPACE T_ARCD_DAT INCLUDING CONTENTS;
CREATE TABLESPACE T_ARCD_DAT DATAFILE 'C:\oracle\product\10.2.0\oradata\SBDB\ARCD.DBF' SIZE 100M REUSE
AUTOEXTEND ON NEXT 50M MAXSIZE UNLIMITED EXTENT MANAGEMENT LOCAL;

-- DEFININDO USUÁRIO DE ESQUEMA
DROP USER ARCD CASCADE;
CREATE USER ARCD IDENTIFIED BY XXXXXX DEFAULT TABLESPACE T_ARCD_DAT;
GRANT DBA TO ARCD;
GRANT SELECT ON DBA_JOBS TO ARCD;
GRANT ALL PRIVILEGES TO ARCD;

-- CONECTANDO COM USUÁRIO DE ESQUEMA
DISCONNECT;
CONNECT ARCD/XXXX@SBDB;

/* **********************************************************************************
   CRIAÇÃO DE TABELAS
*/

-- TABELA CD
CREATE TABLE ARCD."CD" (
   "ETIQUETA" VARCHAR2 (13),
   "ASSUNTO" VARCHAR2 (200),
   "CONTEUDO" CLOB,
   "LOCALIZACAO" VARCHAR2 (50),
   "DATA_CRIACAO" DATE
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."CD" ADD CONSTRAINT "ID_CD"
PRIMARY KEY("ETIQUETA");

COMMENT ON TABLE ARCD."CD" IS 'ARCD | Lista de CDs catalogados. | CD';

COMMENT ON COLUMN ARCD."CD"."ETIQUETA" IS 'Etiqueta. | Etiqueta';
COMMENT ON COLUMN ARCD."CD"."ASSUNTO" IS 'Assunto do CD. | Assunto';
COMMENT ON COLUMN ARCD."CD"."CONTEUDO" IS 'Conteúdo. | Conteúdo';
COMMENT ON COLUMN ARCD."CD"."LOCALIZACAO" IS 'Local onde se encontra o CD. | Local';
COMMENT ON COLUMN ARCD."CD"."DATA_CRIACAO" IS 'Data de cadastro. | Data de Cadastro';
COMMENT ON COLUMN ARCD."CD".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."CD".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."CD".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."CD".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."CD".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."CD".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."CD".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA CD_HISTORICO
CREATE TABLE ARCD."CD_HISTORICO" (
   "ETIQUETA" VARCHAR2 (13),
   "SEQ" NUMBER (5,0),
   "ACAO" VARCHAR2 (30),
   "DATA_MOVIMENTACAO" DATE,
   "OBS" VARCHAR2 (300),
   "FUNCIONARIO" VARCHAR2 (20)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."CD_HISTORICO" ADD CONSTRAINT "ID_CD_HISTORICO"
PRIMARY KEY("ETIQUETA", "SEQ");

COMMENT ON TABLE ARCD."CD_HISTORICO" IS 'ARCD | Histórico de retirada de CDs. | Histórico do CD';

COMMENT ON COLUMN ARCD."CD_HISTORICO"."ETIQUETA" IS 'Etiqueta. | Etiqueta';
COMMENT ON COLUMN ARCD."CD_HISTORICO"."SEQ" IS 'Sequencial. | Sequencial';
COMMENT ON COLUMN ARCD."CD_HISTORICO"."ACAO" IS 'Situação. R=Retirada, D=Devolução | Situação';
COMMENT ON COLUMN ARCD."CD_HISTORICO"."DATA_MOVIMENTACAO" IS 'Data da movimentação. | Data da Movimentação';
COMMENT ON COLUMN ARCD."CD_HISTORICO"."OBS" IS 'Observação. | Observação';
COMMENT ON COLUMN ARCD."CD_HISTORICO"."FUNCIONARIO" IS 'Funcionário. | Funcionário';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."CD_HISTORICO".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA CLASSE
CREATE TABLE ARCD."CLASSE" (
   "REF_CLASSE" VARCHAR2 (4),
   "DESCRICAO" VARCHAR2 (100)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."CLASSE" ADD CONSTRAINT "ID_CLASSE"
PRIMARY KEY("REF_CLASSE");

COMMENT ON TABLE ARCD."CLASSE" IS 'ARCD | Classe de material catalogado. | Classe';

COMMENT ON COLUMN ARCD."CLASSE"."REF_CLASSE" IS 'Classe. | Classe';
COMMENT ON COLUMN ARCD."CLASSE"."DESCRICAO" IS 'Descrição. | Descrição';
COMMENT ON COLUMN ARCD."CLASSE".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."CLASSE".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."CLASSE".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."CLASSE".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."CLASSE".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."CLASSE".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."CLASSE".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA DEPARTAMENTO
CREATE TABLE ARCD."DEPARTAMENTO" (
   "MATRICULA" VARCHAR2 (20),
   "NOME" VARCHAR2 (50),
   "CARGO" VARCHAR2 (50)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."DEPARTAMENTO" ADD CONSTRAINT "ID_DEPARTAMENTO"
PRIMARY KEY("MATRICULA");

COMMENT ON TABLE ARCD."DEPARTAMENTO" IS 'ARCD | Departamento que efetua movimentação. | Departamento';

COMMENT ON COLUMN ARCD."DEPARTAMENTO"."MATRICULA" IS 'Matrícula do associado. | Matrícula do Associado';
COMMENT ON COLUMN ARCD."DEPARTAMENTO"."NOME" IS 'Nome. | Nome';
COMMENT ON COLUMN ARCD."DEPARTAMENTO"."CARGO" IS 'Cargo. | Cargo';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."DEPARTAMENTO".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA SYS_CONFIG_GLOBAL
CREATE TABLE ARCD."SYS_CONFIG_GLOBAL" (
   "PARAM" VARCHAR2 (200),
   "DESCR" VARCHAR2 (4000),
   "CONFIG" CLOB,
   "PROP_EXTEND" CLOB,
   "FORMATO" VARCHAR2 (100)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."SYS_CONFIG_GLOBAL" ADD CONSTRAINT "ID_SYS_CONFIG_GLOBAL"
PRIMARY KEY("PARAM");

COMMENT ON TABLE ARCD."SYS_CONFIG_GLOBAL" IS 'Sistema | Armazena parâmetros globais do aplicativo. | Configuração Global';

COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL"."PARAM" IS 'Parametro. | Parâmetro';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL"."DESCR" IS 'Descrição. | Descrição';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL"."CONFIG" IS 'Configuração. | Configuração';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL"."PROP_EXTEND" IS 'Propriedades extendidas para configuração. | Propriedades';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL"."FORMATO" IS 'Formato de apresentação do campo MEMO, HTML ou vazio para texto comum. | Formato';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."SYS_CONFIG_GLOBAL".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA SYS_CONFIG_USUARIO
CREATE TABLE ARCD."SYS_CONFIG_USUARIO" (
   "USUARIO" VARCHAR2 (100),
   "PARAM" VARCHAR2 (200),
   "DESCR" VARCHAR2 (4000),
   "CONFIG" VARCHAR2 (4000)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."SYS_CONFIG_USUARIO" ADD CONSTRAINT "ID_SYS_CONFIG_USUARIO"
PRIMARY KEY("USUARIO", "PARAM");

COMMENT ON TABLE ARCD."SYS_CONFIG_USUARIO" IS 'Sistema | Parâmetros específicos de usuários do sistema. | Configuração de Usuário';

COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO"."USUARIO" IS 'Usuário. | Usuário';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO"."PARAM" IS 'Parametro. | Parâmetro';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO"."DESCR" IS 'Descrição. | Descrição';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO"."CONFIG" IS 'Configuração. | Configuração';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."SYS_CONFIG_USUARIO".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA SYS_DELETE
CREATE TABLE ARCD."SYS_DELETE" (
   "TABELA" VARCHAR2 (70),
   "CHAVE" VARCHAR2 (300),
   "MOMENTO" DATE,
   "USUARIO" VARCHAR2 (100),
   "LOCAL" VARCHAR2 (20)
);

ALTER TABLE ARCD."SYS_DELETE" ADD CONSTRAINT "ID_SYS_DELETE"
PRIMARY KEY("TABELA", "CHAVE");

COMMENT ON TABLE ARCD."SYS_DELETE" IS 'Sistema | Registro de exclusões do sistema. | Registro de Exclusões';

COMMENT ON COLUMN ARCD."SYS_DELETE"."TABELA" IS 'Nome da tabela onde a exclusão ocorreu. | Tabela';
COMMENT ON COLUMN ARCD."SYS_DELETE"."CHAVE" IS 'Conteúdo da chave do registro excluído. | Chave';
COMMENT ON COLUMN ARCD."SYS_DELETE"."MOMENTO" IS 'Momento em que ocorreu a exclusão. | Momento de Exclusão';
COMMENT ON COLUMN ARCD."SYS_DELETE"."USUARIO" IS 'Detalhes do usuário que efetuou a exclusão. | Usuário';
COMMENT ON COLUMN ARCD."SYS_DELETE"."LOCAL" IS 'De onde partiu a exclusão. | Local';

-- TABELA SYS_LOCALID
CREATE TABLE ARCD."SYS_LOCALID" (
   "NOME" VARCHAR2 (20),
   "CORRENTE" NUMBER (1,0),
   "PACOTE" NUMBER (11,0),
   "PACOTE_REC" NUMBER (11,0),
   "MOMENTO" DATE,
   "MOMENTO_REC" DATE,
   "MODELO" NUMBER (11,0),
   "DESCR" VARCHAR2 (50),
   "OBS" VARCHAR2 (4000)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."SYS_LOCALID" ADD CONSTRAINT "ID_SYS_LOCALID"
PRIMARY KEY("NOME");

COMMENT ON TABLE ARCD."SYS_LOCALID" IS 'Sistema | Especificações de localidade para sistema distribuído. | Detalhes de Localidade';

COMMENT ON COLUMN ARCD."SYS_LOCALID"."NOME" IS 'Nome em caso de sistema distribuído. | Nome';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."CORRENTE" IS 'Marcado caso seja localidade corrente. | Corrente';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."PACOTE" IS 'Número do último pacote gerado. | Pacote Gerado';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."PACOTE_REC" IS 'Número do último pacote recebido. | Pacote Recebido';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."MOMENTO" IS 'Momento do último pacote gerado. | Momento de Geração';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."MOMENTO_REC" IS 'Momento do último pacote recebido. | Momento de Recebimento';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."MODELO" IS 'Modelo. | Modelo';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."DESCR" IS 'Descrição de localidade, responsabilidade ou qualquer texto que informe sobre a localidade. | Descrição';
COMMENT ON COLUMN ARCD."SYS_LOCALID"."OBS" IS 'Observações sobre a localidade. | Observações';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."SYS_LOCALID".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA SYS_OCORRENCIA
CREATE TABLE ARCD."SYS_OCORRENCIA" (
   "SEQ" NUMBER (11,0),
   "APLICACAO" VARCHAR2 (4000),
   "OCORRENCIA" VARCHAR2 (4000),
   "USUARIO" VARCHAR2 (100),
   "MOMENTO" DATE,
   "LOCAL" VARCHAR2 (20)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."SYS_OCORRENCIA" ADD CONSTRAINT "ID_SYS_OCORRENCIA"
PRIMARY KEY("SEQ");

COMMENT ON TABLE ARCD."SYS_OCORRENCIA" IS 'Sistema | Registro de ocorrências do sistema. | Registro de Ocorrências';

COMMENT ON COLUMN ARCD."SYS_OCORRENCIA"."SEQ" IS 'Sequencial da ocorrência. | Sequencial';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA"."APLICACAO" IS 'Nome do aplicativo onde ocorreu o registro. | Aplicação';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA"."OCORRENCIA" IS 'Detalhes da ocorrência. | Ocorrência';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA"."USUARIO" IS 'Usuário logado no momento da ocorrência. | Usuário';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA"."MOMENTO" IS 'Momento em que ocorreu a situação. | Momento';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA"."LOCAL" IS 'Local onde ocorreu o registro. | Localidade';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."SYS_OCORRENCIA".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

-- TABELA USUARIO
CREATE TABLE ARCD."USUARIO" (
   "MATRICULA" VARCHAR2 (20),
   "NOME" VARCHAR2 (50),
   "CARGO" VARCHAR2 (50),
   "CANCEL" NUMBER (1,0),
   "DEPARTAMENTO" VARCHAR2 (50)
,
   SYS_MOMENTO_CRIA DATE,
   SYS_USUARIO_CRIA VARCHAR2 (100),
   SYS_LOCAL_CRIA VARCHAR2 (100),
   SYS_MOMENTO_ATUALIZA DATE,
   SYS_USUARIO_ATUALIZA VARCHAR2 (100),
   SYS_LOCAL_ATUALIZA VARCHAR2 (100),
   SYS_STATUS CHAR (1)
);

ALTER TABLE ARCD."USUARIO" ADD CONSTRAINT "ID_USUARIO"
PRIMARY KEY("MATRICULA");

COMMENT ON TABLE ARCD."USUARIO" IS 'ARCD | Usuários que solicitam material. | Usuário';

COMMENT ON COLUMN ARCD."USUARIO"."MATRICULA" IS 'Matrícula do associado. | Matrícula do Associado';
COMMENT ON COLUMN ARCD."USUARIO"."NOME" IS 'Nome. | Nome';
COMMENT ON COLUMN ARCD."USUARIO"."CARGO" IS 'Cargo. | Cargo';
COMMENT ON COLUMN ARCD."USUARIO"."CANCEL" IS 'Marcar para informar que este usuário foi cancelado. | Cancelado';
COMMENT ON COLUMN ARCD."USUARIO"."DEPARTAMENTO" IS 'Departamento. | Departamento';
COMMENT ON COLUMN ARCD."USUARIO".SYS_MOMENTO_CRIA IS 'Registra momento de gravação. | Momento de Criação';
COMMENT ON COLUMN ARCD."USUARIO".SYS_USUARIO_CRIA IS 'Registra usuário que gravou. | Usuário que Criou';
COMMENT ON COLUMN ARCD."USUARIO".SYS_LOCAL_CRIA IS 'Registra local de gravação. | Local de Criação';
COMMENT ON COLUMN ARCD."USUARIO".SYS_MOMENTO_ATUALIZA IS 'Registra momento de atualização. | Momento de Atualização';
COMMENT ON COLUMN ARCD."USUARIO".SYS_USUARIO_ATUALIZA IS 'Registra usuário que atualizou. | Usuário que Alterou';
COMMENT ON COLUMN ARCD."USUARIO".SYS_LOCAL_ATUALIZA IS 'Registra local de atualização. | Local de Alteração';
COMMENT ON COLUMN ARCD."USUARIO".SYS_STATUS IS 'Status do registro entre I=Incluído, A=Alterado ou Vazio=Sem modificação. | Status do Registro';

/* **********************************************************************************
   CRIAÇÃO DE TABELAS DO SISTEMA
*/


-- TABELA DE SISTEMA - GRANTS GERAIS
GRANT SELECT ON ARCD.SYS_CONFIG_GLOBAL TO PUBLIC;
GRANT SELECT ON ARCD.SYS_CONFIG_USUARIO TO PUBLIC;
GRANT SELECT ON ARCD.SYS_DELETE TO PUBLIC;
GRANT SELECT ON ARCD.SYS_LOCALID TO PUBLIC;
GRANT SELECT ON ARCD.SYS_OCORRENCIA TO PUBLIC;
SPOOL OFF


-- EXEMPLO PARA IMPORT DE INFORMAÇÕES E 
-- CÓDIGO PARA ELIMINAR OBJETOS IMPORTADOS EQUIVOCADAMENTE

SET SERVEROUTPUT ON SIZE 40000
SET ECHO OFF
SELECT
'EXP ARCD/XXXX@SBDB OWNER=(ARCD) FILE=ARCD.DMP LOG=ARCD_EXP.LOG' || CHR(13) || CHR(10) ||
'IMP ARCD/XXXX@SBDB FROMUSER=ARCD CONSTRAINTS=NO GRANTS=NO FILE=ARCD.DMP LOG=ARCD_IMP.LOG IGNORE=YES' || CHR(13) || CHR(10) ||
'' || CHR(13) || CHR(10) ||
'' || CHR(13) || CHR(10) ||
'DECLARE' || CHR(13) || CHR(10) ||
'    MAX NUMBER := ' || MAX(OBJECT_ID) || ';' || CHR(13) || CHR(10) ||
'BEGIN' || CHR(13) || CHR(10) ||
' FOR CUR IN (SELECT ''DROP '' || OBJECT_TYPE || '' '' || OWNER || ''.'' || OBJECT_NAME ' || CHR(13) || CHR(10) ||
' AS COL FROM ALL_OBJECTS WHERE OBJECT_ID > MAX) LOOP' || CHR(13) || CHR(10) ||
'  DBMS_OUTPUT.PUT(CUR.COL);' || CHR(13) || CHR(10) ||
'  BEGIN' || CHR(13) || CHR(10) ||
'   EXECUTE IMMEDIATE CUR.COL;' || CHR(13) || CHR(10) ||
'   DBMS_OUTPUT.PUT_LINE('' ==> OK'');' || CHR(13) || CHR(10) ||
'  EXCEPTION WHEN OTHERS THEN' || CHR(13) || CHR(10) ||
'   DBMS_OUTPUT.PUT_LINE('' ==> '' || SQLERRM);' || CHR(13) || CHR(10) ||
'  END;' || CHR(13) || CHR(10) ||
' END LOOP;' || CHR(13) || CHR(10) ||
'END;' || CHR(13) || CHR(10) ||
'/' || CHR(13) || CHR(10) ||
'' || CHR(13) || CHR(10) ||
'' || CHR(13) || CHR(10) FROM ALL_OBJECTS
/



SPOOL OFF
$ECHO - >>"C:\ARCD_PARTES.LOG"
$ECHO - >>"C:\ARCD_PARTES.LOG"
$ECHO - >>"C:\ARCD_PARTES.LOG"
$COMMAND /C ECHO %DATE% %TIME% >>"C:\ARCD_PARTES.LOG"
$COMMAND /C FIND "ORA-" "C:\ARCD_PARTE1.LOG" >>"C:\ARCD_PARTES.LOG"
$COMMAND /C FIND "SP2-" "C:\ARCD_PARTE1.LOG" >>"C:\ARCD_PARTES.LOG"
