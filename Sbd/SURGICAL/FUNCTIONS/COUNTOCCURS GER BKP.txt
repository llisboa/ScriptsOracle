CREATE OR REPLACE
  FUNCTION COUNTOCCURS
    (
      STR CLOB,
      SEARCH CLOB := NULL)
    RETURN NUMBER
  IS
  BEGIN
    IF (SEARCH IS NULL) THEN
      RETURN LENGTH (STR) ;
    ELSE
      RETURN (LENGTH (STR)                         -
      NVL (LENGTH (REPLACE (STR, SEARCH, '')), 0)) / LENGTH (SEARCH) ;
    END IF;
  END COUNTOCCURS;