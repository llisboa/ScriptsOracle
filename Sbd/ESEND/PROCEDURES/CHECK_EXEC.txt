CREATE OR REPLACE
PROCEDURE ESEND.CHECK_EXEC
AS
  STATUS VARCHAR2 (200) ;
  ULT_MOM DATE;
  MAX_MINS_SEM_CHECK INTEGER;
BEGIN
  BEGIN
     SELECT TO_NUMBER(CONFIG)
       INTO MAX_MINS_SEM_CHECK
       FROM ESEND.SYS_CONFIG_GLOBAL
      WHERE PARAM = 'ESEND_INTERV_CONFIRM_PRES';
  EXCEPTION
  WHEN OTHERS THEN
    MAX_MINS_SEM_CHECK := 20;
  END;
  BEGIN
     SELECT CONFIG
       INTO STATUS
       FROM ESEND.SYS_CONFIG_GLOBAL
      WHERE PARAM = 'ESEND_STATUS_ULTIMO';
    
    ULT_MOM                      := TO_DATE (LPAD (STATUS, 16), 'DD/MM/YYYY HH24:MI:SS') ;
    IF (SYSDATE - ULT_MOM) * 1440 < MAX_MINS_SEM_CHECK THEN
      STATUS                     := '';
    END IF;
  EXCEPTION
  WHEN OTHERS THEN
    STATUS := 'NUNCA EXECUTOU OU NÃO FOI POSSÍVEL DETERMINAR';
  END;
  IF LENGTH(STATUS)>0 THEN
    SBDB.SENDMAIL ('WEB@xxxxxxx.com.br', 'WEB@xxxxxxx.com.br', 'SBD - ESENDWEB - PARADA NO APLICATIVO', '<HTML><BODY><H1>ATENÇÃO</H1>PELO MENOS DURANTE ' || MAX_MINS_SEM_CHECK || ' MINS, O PROGRAMA ESENDAPP NÃO REALIZOU CHECAGENS. FAVOR VERIFICAR.<BR/><BR/>ÚLTIMO STATUS:' || STATUS || '</BODY></HTML>') ;
  END IF;
END CHECK_EXEC;